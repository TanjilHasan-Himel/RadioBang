<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radio Bang — Live + Library + Search</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    :root{
      /* Dark-only palette */
      --bg:#0b0c0f; --panel:#12151b; --ink:#e9ecf1; --muted:#9aa3b2; --line:#1f2631;
      --primary:#e11932; --secondary:#7a869a; --accent:#ff7a90;
      --radius-xl:26px; --radius-lg:18px; --radius-md:12px;
      --shadow-1:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.55}
    .container{max-width:1160px;margin:0 auto;padding:22px}

    /* Header */
    header{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding-bottom:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:56px;height:56px;border-radius:14px;object-fit:contain;background:#0c1117;border:1px solid var(--line)}
    .titles{display:flex;flex-direction:column}
    .title{font-size:clamp(1.5rem,1rem+1.6vw,2.2rem);font-weight:900;letter-spacing:-.02em;margin:0}
    .tag{color:var(--muted)}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:var(--primary);color:#fff;font-weight:800;letter-spacing:.06em;text-transform:uppercase}
    .chip .dot{width:8px;height:8px;border-radius:50%;background:#fff}

    /* Mode selector */
    .modes{margin-top:16px;display:flex;gap:8px;flex-wrap:wrap}
    .seg{display:inline-flex;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .seg button{padding:8px 12px;border:none;background:#0f1217;color:var(--ink);cursor:pointer}
    .seg button.active{background:var(--primary);color:#fff}

    /* Live hero */
    .hero{margin-top:16px;display:grid;grid-template-columns:320px 1fr;gap:18px;background:linear-gradient(180deg,var(--panel),#0e1217);border:1px solid var(--line);border-radius:var(--radius-xl);padding:22px;box-shadow:var(--shadow-1)}
    .artwrap{aspect-ratio:1/1;border-radius:20px;overflow:hidden;background:linear-gradient(180deg,#1a2028,#131820);display:grid;place-items:center;position:relative}
    .artwrap img{width:100%;height:100%;object-fit:cover}
    .badge{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.55);color:#fff;border-radius:999px;padding:6px 10px;font-weight:800;letter-spacing:.04em}
    .info{display:grid;gap:12px}
    .eyebrow{color:var(--secondary);text-transform:uppercase;letter-spacing:.18em;font-weight:800;font-size:.8rem}
    .track{font-weight:900;letter-spacing:-.02em;font-size:clamp(1.2rem,1rem+1.2vw,1.8rem)}
    .sub{color:var(--muted)}

    .live-controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-top:6px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid var(--line);background:var(--primary);color:#fff;border-radius:999px;padding:12px 16px;cursor:pointer;font-weight:900}
    .btn-icon{width:64px;height:64px;border-radius:50%}
    .vol{display:flex;align-items:center;gap:10px;background:#0f1319;border:1px solid var(--line);border-radius:999px;padding:10px 14px}
    .vol i{color:var(--secondary)}
    input[type=range]{width:180px;height:4px;appearance:none;background:#202837;border-radius:99px;outline:none}
    input[type=range]::-webkit-slider-thumb{appearance:none;width:16px;height:16px;border-radius:50%;background:#ffb0bd;border:2px solid #0b0c0f;box-shadow:0 2px 8px rgba(0,0,0,.2)}
    .status{display:flex;align-items:center;gap:8px;color:var(--secondary)}
    .status .dot{width:8px;height:8px;border-radius:50%;background:#9aa3b5}
    .status.playing .dot{background:#22c55e}
    .status.error .dot{background:#ff3b30}

    /* Panels row */
    .row{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:16px}

    /* Library panel */
    .panel{background:linear-gradient(180deg,var(--panel),#0e1217);border:1px solid var(--line);border-radius:var(--radius-xl);padding:16px;min-height:360px}
    .panel h2{margin:0 0 10px;font-size:1rem}
    .lib{display:grid;grid-template-columns:240px 1fr;gap:12px}
    .folders{border:1px solid var(--line);border-radius:12px;background:#0f141a;overflow:auto}
    .folder-item{padding:10px 12px;border-bottom:1px solid #1a1f28;display:flex;align-items:center;gap:8px;cursor:pointer}
    .folder-item:hover{background:#121824}
    .folder-item.active{background:#1a202b}
    .tracks{border:1px solid var(--line);border-radius:12px;background:#0f141a;overflow:auto}
    .track-row{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #1a1f28}
    .track-row small{color:var(--muted)}
    .actions button{background:none;border:1px solid var(--line);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}

    .transport{display:flex;align-items:center;gap:10px;margin-top:10px}
    .transport .btn{background:#0f1319}
    .times{display:flex;align-items:center;gap:10px;margin-left:auto;color:var(--muted)}

    /* Search panel */
    .searchbar{display:flex;gap:8px;margin-bottom:10px}
    .searchbar input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f141a;color:var(--ink)}
    .searchbar button{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:var(--primary);color:#fff;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
    .card{border:1px solid var(--line);border-radius:14px;background:#0f141a;padding:12px;display:grid;gap:6px}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:10px}
    .card .meta{color:var(--muted);font-size:.85rem}

    /* Footer */
    footer{margin:26px 0 6px;text-align:center;color:var(--muted)}

    @media (max-width:980px){
      .hero{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
      .lib{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img src="image/logo.png" alt="Radio Bang logo" />
        <div class="titles">
          <h1 class="title">Radio Bang</h1>
          <div class="tag">Bang Your Day with Bang</div>
        </div>
      </div>
      <div class="chip"><span class="dot"></span> On Air</div>
    </header>

    <div class="modes">
      <div class="seg" aria-label="Mode selector">
        <button id="tabLive" class="active">Live</button>
        <button id="tabLibrary">Library</button>
        <button id="tabSearch">Online</button>
      </div>
    </div>

    <!-- LIVE -->
    <section class="hero" id="liveView" aria-label="Live">
      <div class="artwrap">
        <img src="image/logo.png" alt="Station artwork" />
        <div class="badge" id="badge">LIVE</div>
      </div>
      <div class="info">
        <div class="eyebrow" id="npLabel">Now Playing</div>
        <div class="track" id="trackTitle">Live Session — Radio Bang</div>
        <div class="sub" id="trackSub">Broadcasting the future of sound</div>
        <div class="live-controls">
          <button class="btn btn-icon" id="playBtn" aria-label="Play/Pause"><i class="fas fa-play" id="playIcon"></i></button>
          <div class="vol" role="group" aria-label="Volume"><i class="fas fa-volume-up" id="volIcon"></i><input type="range" id="volume" min="0" max="100" value="70"></div>
          <div class="status" id="status"><span class="dot"></span><span id="statusText">Ready to connect</span></div>
        </div>
        <audio id="player" preload="none" crossorigin="anonymous"></audio>
      </div>
    </section>

    <div class="row">
      <!-- LIBRARY -->
      <section class="panel" id="libraryView" aria-label="Library" style="display:none">
        <h2>Music Library</h2>
        <div class="lib">
          <div class="folders" id="folderList" aria-label="Folders"></div>
          <div class="tracks">
            <div id="trackList"></div>
            <div class="transport">
              <button class="btn" id="prevBtn"><i class="fas fa-backward"></i> Prev</button>
              <button class="btn" id="libPlayBtn"><i class="fas fa-play" id="libPlayIcon"></i> Play</button>
              <button class="btn" id="nextBtn">Next <i class="fas fa-forward"></i></button>
              <div class="times"><span id="curTime">0:00</span>
                <input type="range" id="seek" min="0" max="100" value="0" step="1" aria-label="Seek" />
                <span id="durTime">0:00</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SEARCH (Online via iTunes API previews) -->
      <section class="panel" id="searchView" aria-label="Online Search" style="display:none">
        <h2>Online Search (Official 30s previews)</h2>
        <div class="searchbar">
          <input id="searchInput" placeholder="Search songs or artists" />
          <button id="searchBtn"><i class="fas fa-search"></i> Search</button>
        </div>
        <div class="grid" id="resultsGrid"></div>
        <small style="color:var(--muted);display:block;margin-top:8px">Powered by Apple iTunes Search API (previews only — safe & free).</small>
      </section>
    </div>

    <div class="social" style="margin-top:16px;display:flex;gap:12px;flex-wrap:wrap">
      <a class="slink" href="#" target="_blank" rel="noopener"><i class="fab fa-facebook-f"></i>Facebook</a>
      <a class="slink" href="#" target="_blank" rel="noopener"><i class="fab fa-instagram"></i>Instagram</a>
      <a class="slink" href="#" target="_blank" rel="noopener"><i class="fab fa-discord"></i>Discord</a>
    </div>

    <footer>© <span id="year"></span> Radio Bang — A station by Tanjil Hasan Himel</footer>
  </div>

  <script>
    ;(()=>{
      // ---------- CONFIG ----------
      const STREAM_URL = 'http://localhost:8000/stream'
      const LIB_INDEX = '/musics/index.json'  // <-- place this JSON file on your server (see structure below)
      const DEFAULT_ART = 'image/logo.png'

      // Expected /musics/index.json structure:
      // {
      //   "folders": [
      //     {"name":"Daily Uploads","tracks":[{"title":"Fresh 01","artist":"Radio Bang","file":"daily/fresh01.mp3","cover":"image/logo.png"}]},
      //     {"name":"Bangla Hits","tracks":[{"title":"Bangla Track 01","artist":"Band X","file":"bangla/track01.mp3"}]}
      //   ]
      // }

      // ---------- ELEMENTS ----------
      const tabLive = document.getElementById('tabLive')
      const tabLibrary = document.getElementById('tabLibrary')
      const tabSearch = document.getElementById('tabSearch')
      const liveView = document.getElementById('liveView')
      const libraryView = document.getElementById('libraryView')
      const searchView = document.getElementById('searchView')

      const player = document.getElementById('player')
      const playBtn = document.getElementById('playBtn')
      const playIcon = document.getElementById('playIcon')
      const volume = document.getElementById('volume')
      const volIcon = document.getElementById('volIcon')
      const status = document.getElementById('status')
      const statusText = document.getElementById('statusText')
      const trackTitle = document.getElementById('trackTitle')
      const trackSub = document.getElementById('trackSub')

      const folderList = document.getElementById('folderList')
      const trackList = document.getElementById('trackList')
      const prevBtn = document.getElementById('prevBtn')
      const nextBtn = document.getElementById('nextBtn')
      const libPlayBtn = document.getElementById('libPlayBtn')
      const libPlayIcon = document.getElementById('libPlayIcon')
      const seek = document.getElementById('seek')
      const curTime = document.getElementById('curTime')
      const durTime = document.getElementById('durTime')

      document.getElementById('year').textContent = new Date().getFullYear()

      // ---------- STATE ----------
      let mode = 'live' // 'live' | 'library' | 'search'
      let library = { folders: [] }
      let flatTracks = []
      let currentFolder = null
      let currentIndex = -1
      let isSeeking = false

      // ---------- MODE SWITCH ----------
      function setTab(active){
        tabLive.classList.toggle('active', active==='live')
        tabLibrary.classList.toggle('active', active==='library')
        tabSearch.classList.toggle('active', active==='search')
        liveView.style.display = active==='live' ? '' : 'none'
        libraryView.style.display = active==='library' ? '' : 'none'
        searchView.style.display = active==='search' ? '' : 'none'
        mode = active
        if(mode==='live') startLive()
      }
      tabLive.addEventListener('click', ()=> setTab('live'))
      tabLibrary.addEventListener('click', ()=> setTab('library'))
      tabSearch.addEventListener('click', ()=> setTab('search'))

      // ---------- LIVE PLAYER (no next/prev/seek) ----------
      player.volume = 0.7
      function setVolIcon(v){
        if(v===0) volIcon.className='fas fa-volume-mute'; else if(v<0.35) volIcon.className='fas fa-volume-off'; else if(v<0.75) volIcon.className='fas fa-volume-down'; else volIcon.className='fas fa-volume-up'
      }
      volume.addEventListener('input', e=>{ const v = Number(e.target.value)/100; player.volume = v; setVolIcon(v) })

      async function startLive(){
        player.src = STREAM_URL
        trackTitle.textContent = 'Radio Bang — Live Stream'
        trackSub.textContent = 'LIVE Stream'
        setStatus('Connecting…')
        try{ await player.play(); setStatus('LIVE','playing'); playIcon.className='fas fa-pause' }catch{ setStatus('Connection failed','error'); playIcon.className='fas fa-play' }
      }
      function setStatus(text, state){ statusText.textContent=text; status.classList.remove('playing','error'); if(state==='playing') status.classList.add('playing'); if(state==='error') status.classList.add('error') }
      playBtn.addEventListener('click', async ()=>{
        if(mode!=='live'){ setTab('live'); return }
        if(player.paused){ setStatus('Connecting…'); try{ await player.play(); setStatus('LIVE','playing'); playIcon.className='fas fa-pause' }catch{ setStatus('Connection failed','error') } }
        else { player.pause(); setStatus('Paused'); playIcon.className='fas fa-play' }
      })
      player.addEventListener('pause', ()=>{ if(mode==='live') { setStatus('Paused'); playIcon.className='fas fa-play' } })

      // ---------- LIBRARY (folders under /musics) ----------
      async function loadLibrary(){
        try{
          const res = await fetch(LIB_INDEX, {cache:'no-store'})
          if(!res.ok) throw new Error('no index.json')
          library = await res.json()
        }catch(err){
          console.warn('No /musics/index.json found. Using demo data.')
          library = { folders: [
            {name:'Daily Uploads', tracks:[{title:'Fresh 01', artist:'Radio Bang', file:'daily/fresh01.mp3'}, {title:'Fresh 02', artist:'Radio Bang', file:'daily/fresh02.mp3'}]},
            {name:'Bangla Hits', tracks:[{title:'Bangla Track 01', artist:'Band X', file:'bangla/track01.mp3'}]},
            {name:'Chill', tracks:[{title:'Chill 01', artist:'DJ Cool', file:'chill/chill01.mp3'}]},
            {name:'Old is Gold', tracks:[{title:'Classic 01', artist:'Legend', file:'classic/old01.mp3'}]}
          ] }
        }
        flatTracks = []
        folderList.innerHTML = ''
        library.folders.forEach((f,fi)=>{
          const el = document.createElement('div')
          el.className = 'folder-item'
          el.innerHTML = `<i class="fas fa-folder"></i> <span>${f.name}</span>`
          el.addEventListener('click', ()=> selectFolder(fi))
          folderList.appendChild(el)
        })
        // Auto-open first folder
        if(library.folders.length) selectFolder(0)
      }

      function selectFolder(index){
        currentFolder = index
        ;[...folderList.children].forEach((n,i)=> n.classList.toggle('active', i===index))
        const f = library.folders[index]
        trackList.innerHTML = ''
        flatTracks = f.tracks.map((t)=> ({...t, full:`/musics/${t.file}`}))
        flatTracks.forEach((t,ti)=>{
          const row = document.createElement('div')
          row.className='track-row'
          row.innerHTML = `<div><strong>${t.title||t.file}</strong><br><small>${t.artist||'Unknown'} • ${f.name}</small></div>
                           <div class="actions"><button data-i="${ti}"><i class="fas fa-play"></i> Play</button></div>`
          row.querySelector('button').addEventListener('click', (e)=>{ playLibrary(parseInt(e.currentTarget.getAttribute('data-i'))) })
          trackList.appendChild(row)
        })
        currentIndex = -1
        curTime.textContent='0:00'; durTime.textContent='0:00'; seek.value=0
      }

      function playLibrary(idx){
        if(idx<0 || idx>=flatTracks.length) return
        currentIndex = idx
        const t = flatTracks[idx]
        player.src = t.full
        player.load()
        player.play().then(()=>{
          setTab('library')
          libPlayIcon.className='fas fa-pause'
          trackTitle.textContent = t.title || t.file
          trackSub.textContent = (t.artist||'On‑demand') + ' • Library'
        }).catch(()=>{})
      }

      libPlayBtn.addEventListener('click', ()=>{ if(currentIndex===-1){ playLibrary(0) } else if(player.paused){ player.play(); libPlayIcon.className='fas fa-pause' } else { player.pause(); libPlayIcon.className='fas fa-play' } })
      prevBtn.addEventListener('click', ()=>{ if(currentIndex>0) playLibrary(currentIndex-1) })
      nextBtn.addEventListener('click', ()=>{ if(currentIndex<flatTracks.length-1) playLibrary(currentIndex+1) })

      player.addEventListener('timeupdate', ()=>{
        if(mode!=='library' || isSeeking) return
        const p = (player.currentTime/(player.duration||1))*100
        seek.value = Math.round(p)
        curTime.textContent = fmt(player.currentTime)
        durTime.textContent = isFinite(player.duration)?fmt(player.duration):'0:00'
      })
      seek.addEventListener('input', ()=> isSeeking=true)
      seek.addEventListener('change', ()=>{
        if(mode==='library' && isFinite(player.duration)) player.currentTime = (seek.value/100)*player.duration
        isSeeking=false
      })

      function fmt(s){ const m=Math.floor(s/60); const ss=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${ss}` }

      // ---------- SEARCH (iTunes API) ----------
      const resultsGrid = document.getElementById('resultsGrid')
      const searchInput = document.getElementById('searchInput')
      const searchBtn = document.getElementById('searchBtn')

      async function searchOnline(q){
        const url = `https://itunes.apple.com/search?term=${encodeURIComponent(q)}&entity=song&limit=18`
        const res = await fetch(url)
        const data = await res.json()
        return (data.results||[]).map(r=>({
          title:r.trackName, artist:r.artistName, preview:r.previewUrl, art:r.artworkUrl100 && r.artworkUrl100.replace('100x100','300x300')
        }))
      }

      searchBtn.addEventListener('click', async ()=>{
        const q = (searchInput.value||'').trim(); if(!q) return
        resultsGrid.innerHTML = '<div style="color:var(--muted)">Searching…</div>'
        try{
          const items = await searchOnline(q)
          resultsGrid.innerHTML = ''
          if(!items.length){ resultsGrid.innerHTML = '<div style="color:var(--muted)">No results</div>'; return }
          items.forEach((t)=>{
            const card = document.createElement('div')
            card.className='card'
            card.innerHTML = `
              <img src="${t.art||DEFAULT_ART}" alt="cover">
              <div><strong>${t.title}</strong></div>
              <div class="meta">${t.artist||'Unknown'}</div>
              <button class="btn" data-url="${t.preview}"><i class="fas fa-play"></i> Preview</button>
            `
            card.querySelector('button').addEventListener('click', (e)=>{
              const url = e.currentTarget.getAttribute('data-url')
              if(!url) return
              setTab('search')
              player.src = url
              player.play().catch(()=>{})
              trackTitle.textContent = `${t.title}`
              trackSub.textContent = `${t.artist} • Online preview`
              libPlayIcon.className = 'fas fa-pause'
            })
            resultsGrid.appendChild(card)
          })
        }catch(err){ resultsGrid.innerHTML = '<div style="color:var(--muted)">Search error</div>' }
      })

      // ---------- INIT ----------
      setTab('live')
      startLive()
      loadLibrary()
    })()
  </script>
</body>
</html>
